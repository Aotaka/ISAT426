<!DOCTYPE html>
<html lang="en">
<head>
	<title>Simply the Rest</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="css/qgis2web.css"><link rel="stylesheet" href="css/fontawesome-all.min.css">
	
	<style>
    /* Set height of the grid so .sidenav can be 100% (adjust if needed) */
    .row.content {height: 100%}
    
    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #f1f1f1;
      height: 100%;
    }

    #map {
            width: 100%;
            height: 931px;
        }
  </style>
</head>

<body>
<div class="container-fluid">
	<div class="row content">
		<div class="col-sm-3 sidenav">
			<div class="form-group">
  				<label id="usrLabel">Wind%:</label>
  				<input type="number" class="form-control" id="windFactor">
  				
			</div>
			
			<div class="form-group">
  				<label id="msgLabel">Residential%:</label>
  				<input type="number" class="form-control" id="residentialFactor">
      </div>
      
      <div class="form-group">
        <input type="button" value="Submit" id="submit"/>
      </div>
		</div>

		<div class="col-sm-9">
                <div id="map">
                    </div>

		</div>
	</div>
</div>



    <script src="js/qgis2web_expressions.js"></script>
    <script src="js/leaflet.js"></script>
    <script src="js/leaflet-heat.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet.pattern.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/rbush.min.js"></script>
    <script src="js/labelgun.min.js"></script>
    <script src="js/labels.js"></script>
    <script src="data/ne_10m_airports_1.js"></script>
    <script src="data/wind.js"></script>
    <script src="data/residential.js"></script>
    <script>

var layer_ne_10m_airports_1;

function newData(windFactor, residentialFactor) {
      bounds_group = new L.featureGroup([]);
      var ne_10m_airports_1_hm = geoJson2heat(jsonWind, windFactor);
      var ne_residential = geoJson2heat(jsonResidential, residentialFactor);
      var data = ne_10m_airports_1_hm.concat(ne_residential)

      if(layer_ne_10m_airports_1) {
        map.removeLayer(layer_ne_10m_airports_1);
      }

      layer_ne_10m_airports_1 = new L.heatLayer(data, {
        attribution: '',
        radius: 70,
        max: 0.8,
        blur: 40,
        minOpacity: 0.4,
        gradient: {0.7: 'blue', 0.9: 'lime', 1: 'red'}});

        bounds_group.addLayer(layer_ne_10m_airports_1)
        
        map.addLayer(layer_ne_10m_airports_1);

    }

  $(document).ready(function(){
    $('#submit').click(function(){
      var windFactor = document.getElementById('windFactor').value;
      var residentialFactor = document.getElementById('residentialFactor').value;
      console.log(windFactor, residentialFactor)
      newData(windFactor, residentialFactor);
    });
  });

    var map = L.map('map', {
        zoomControl:true, maxZoom:14, minZoom:1
    }).fitBounds([[38,-79],[40.869768,-80]]);

    var bounds_group = new L.featureGroup([]);
    function setBounds() {
    }
    var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        opacity: 1.0,
        attribution: '',
    });

    map.addLayer(layer_OpenStreetMap_0);


    map.on("click", onMapClick);

    function onMapClick(e) {
        console.log("{\"geometry\": {\"coordinates\": [", e.latlng.lng, ",", e.latlng.lat, "]}},")
    }

    setBounds();



    map.createPane('pane_wind');
    map.getPane('pane_wind').style.zIndex = 401;
    map.getPane('pane_wind').style['mix-blend-mode'] = 'normal';
    /*var ne_10m_airports_1_hm = geoJson2heat(jsonWind, 1);
    var ne_residential = geoJson2heat(jsonResidential, 0.1);

    var data = ne_10m_airports_1_hm.concat(ne_residential)
    var layer_ne_10m_airports_1 = new L.heatLayer(data, {
        attribution: '',
        radius: 70,
        max: 0.8,
        blur: 40,
        minOpacity: 0.4,
        gradient: {0.7: 'blue', 0.9: 'lime', 1: 'red'}});
    bounds_group.addLayer(layer_ne_10m_airports_1);
    map.addLayer(layer_ne_10m_airports_1);*/

    function geoJson2heat(geojson, weight) {
      return geojson.features.map(function(feature) {
        return [
          feature.geometry.coordinates[1],
          feature.geometry.coordinates[0],
          (weight /100)
        ];
      });
    }
</script>
</body>
</html>